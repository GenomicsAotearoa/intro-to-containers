# 5. Creating Container images

!!! circle-question "Overview"

    Questions

    - How can I make my own Apptainer container images?
    - How do I document the ‘recipe’ for a Apptainer container image

    Objectives

    - Explain the purpose of a Apptainer Definition File and show some simple examples
    - Understand the different Singularity container file formats.
    - Understand how to build and share your own Apptainer containers.
    - Compare the steps of creating a container image interactively versus a Definition file.


There are lots of reasons why you might want to create your own Apptainer container image.

- You can’t find an existing container image with all the tools you need.
- You want to have a container image to “archive” all the specific software versions you ran for a project.
- You want to share your workflow with someone else.


## Sandbox installation

The most intuitive way to build a container is to do so interactively, this allows you to install packages, configure applications and test commands, then when finished export as an image.

!!! terminal-2 "This is possible using the `--sandbox flag`, for example"

    ```bash
    $ sudo apptainer build --sandbox ubuntu docker://ubuntu
    ```
    This creates an image called `ubuntu` bootstrapped from `docker://ubuntu` You can then run

    ```bash
    $ sudo apptainer shell --writable ubuntu
    ```
    To start setting up your workflow.

    However, there are two big problems with this approach, firstly building a sandbox image requires you to have root access on your machine and therefore unavailable to many people, secondly it doesn’t provide the best support for our ultimate goal of reproducibility.

    This is because, even though you can share the image, the steps taken to create it are unclear. `-sandbox` should only be used for initial prototyping of your image, the rest of the time you should use a definition file.

## Creating a Apptainer Definition File

The Apptainer Definition File is a text file that contains a series of statements that are used to create a container image. In line with the configuration as code approach mentioned above, the definition file can be stored in your code repository alongside your application code and used to create a reproducible image. This means that for a given commit in your repository, the version of the definition file present at that commit can be used to reproduce a container with a known state. It was pointed out earlier in the course, when covering Docker, that this property also applies for Dockerfiles.

Now lets start writing a very simple definition file, make a new file called`my_container.def`. (Either with your command line text editor of choice, or with the Jupyter text editor).

The first two lines we are going to add define where to bootstrap our image from, we cannot just put some application binaries into a blank image, we need the standard system libraries and potentially a wide range of other libraries and tools.

The most straightforward way to achieve this is to start from an existing base image containing an operating system. In this case, we’re going to start from a minimal Ubuntu 20.04 Linux Docker image. Note that we’re using a Docker image as the basis for creating a Apptainer image.

!!! file-code-2 "" 
    ```bash
    Bootstrap: docker
    From: ubuntu:20.04
    ```